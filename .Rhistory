gc()
devtools::build(); devtools::install()
library(CTUNetwork)
runApp('inst/shinyApp')
library(CTUNetwork)
devtools::build();devtools::install()
library(CTUNetwork)
devtools::build();devtools::install()
library(CTUNetwork)
runApp('inst/shinyApp')
runApp('inst/shinyApp')
# Removing the list of all workers at the project level (useless)
Idx = grepl("\\,", AllData()$DataUp$Workers)
DataUpTab[Idx] <- AllData()$DataUp$Workers[Idx] <- NA
AllData()$DataUp$Workers[Idx] <- NA
AllData()$DataUp$Workers[Idx]
# Removing the list of all workers at the project level (useless)
DataUpTab <- AllData()$DataUp
Idx = grepl("\\,", DataUpTab$Workers)
DataUpTab$Workers[Idx] <- NA
DataUpTab$Workers[Idx]
gc()
devtools::build();devtools::install()
library(CTUNetwork)
runApp('inst/shinyApp')
runApp('inst/shinyApp')
runApp('inst/shinyApp')
runApp('inst/shinyApp')
View(DataUpTab)
str(DataUpTab$DLFSupport)
str(DataUpTab$DLFReached)
as.factor(DataUpTab$DLFReached)
# No need to repeat the DLF support value
DataUpTab$DLFSupport[DataUpTab$Levels==F] <- NA
View(DataUpTab)
str(DataUpTab$DLFSupport)
str(DataUpTab$DLFReached)
devtools::build();devtools::install()
library(CTUNetwork)
runApp('inst/shinyApp')
devtools::build();devtools::install()
library(CTUNetwork)
runApp('inst/shinyApp')
devtools::build();devtools::install()
library(CTUNetwork)
runApp('inst/shinyApp')
shiny::runApp('inst/shinyApp')
Data <- DataUp
# Adding up FixedCosts and HourlyCosts
Data$MoneySpent <- rowSums(Data[,c("FixedCosts","HourlyCosts")], na.rm=T)
Data$MoneySpent  <- ifelse(Data$MoneySpent==0,NA,Data$MoneySpent)
# Cumulative sum over package and project levels
Data <- CTUNetwork::AvgTimeBookings(Data)
# Computing the percentage of time worked/time budgeted
Data$TimePercent[!Data$Filt] <- Data$TimeSpent[!Data$Filt]/Data$TimeBudget[!Data$Filt]*100
View(Data)
devtools::build();devtools::install()
library(CTUNetwork)
CTUNetwork::runCTUNetworkApp()
runApp('inst/shinyApp')
Data = DataUp
View(Data)
# Adding up FixedCosts and HourlyCosts
Data$MoneySpent <- rowSums(Data[,c("FixedCosts","HourlyCosts")], na.rm=T)
Data$MoneySpent  <- ifelse(Data$MoneySpent==0,NA,Data$MoneySpent)
# Cumulative sum over package and project levels
Data <- CTUNetwork::AvgTimeBookings(Data)
# Computing the percentage of time worked/time budgeted
Data$TimePercent[!Data$Filt] <- Data$TimeSpent[!Data$Filt]/Data$TimeBudget[!Data$Filt]*100
# Reordering the database according to natural order
Data <- Data[stringr::str_order(Data$ProjectIDs),]
View(Data)
View(Data)
TEMP = Data[Data$ProjectIDs=="P-0634",]
View(TEMP)
head(TEMP$MoneySpent)
Data = DataUp
# Adding up FixedCosts and HourlyCosts
Data$MoneySpent <- rowSums(Data[,c("FixedCosts","HourlyCosts")], na.rm=T)
Data$MoneySpent  <- ifelse(Data$MoneySpent==0,NA,Data$MoneySpent)
DF = Data
TEMP = Data[Data$ProjectIDs=="P-0634",]
View(TEMP)
Data = DataUp
# Cumulative sum over package and project levels
Data <- AvgTimeBookings(Data)
TEMP = Data[Data$ProjectIDs=="P-0634",]
View(TEMP)
Data = DataUp
# Cumulative sum over package and project levels
Data$MoneySpent <- Data$HourlyCosts
Data <- AvgTimeBookings(Data)
TEMP = Data[Data$ProjectIDs=="P-0634",]
View(TEMP)
# Adding up FixedCosts
Data$MoneySpent <- rowSums(Data[,c("FixedCosts","MoneySpent")], na.rm=T)
Data$MoneySpent  <- ifelse(Data$MoneySpent==0,NA,Data$MoneySpent)
TEMP = Data[Data$ProjectIDs=="P-0634",]
head(TEMP$MoneySpent)
View(TEMP)
Data = DataUp
# Cumulative sum over package and project levels
# Data$MoneySpent <- Data$HourlyCosts
Data$MoneySpent[Data$Filt == T] <- rowSums(Data[Data$Filt == T, c("FixedCosts","HourlyCosts")], na.rm=T)
TEMP = Data[Data$ProjectIDs=="P-0634",]
View(TEMP)
which(!is.na(TEMP$FixedCosts))
Data <- AvgTimeBookings(Data)
# Adding up FixedCosts
Data$MoneySpent <- rowSums(Data[,c("FixedCosts","MoneySpent")], na.rm=T)
Data$MoneySpent  <- ifelse(Data$MoneySpent==0,NA,Data$MoneySpent)
TEMP = Data[Data$ProjectIDs=="P-0634",]
View(TEMP)
TEMP$MoneySpent[2]
TEMP$MoneySpent[2]-5760
Data = DataUp
Data$MoneySpent <- Data$HourlyCosts
# Data$MoneySpent[Data$Filt == T] <- rowSums(Data[Data$Filt == T, c("FixedCosts","HourlyCosts")], na.rm=T)
Data <- AvgTimeBookings(Data)
# Adding up FixedCosts
Data$MoneySpent <- rowSums(Data[,c("FixedCosts","MoneySpent")], na.rm=T)
Data$MoneySpent  <- ifelse(Data$MoneySpent==0,NA,Data$MoneySpent)
TEMP = Data[Data$ProjectIDs=="P-0634",]
TEMP$MoneySpent[2]
169435.3 + 5760
View(TEMP)
Data = DataUp
Data$MoneySpent <- Data$HourlyCosts
# Data$MoneySpent[Data$Filt == T] <- rowSums(Data[Data$Filt == T, c("FixedCosts","HourlyCosts")], na.rm=T)
Data <- AvgTimeBookings(Data)
# Adding up FixedCosts
Data$MoneySpent <- rowSums(Data[,c("FixedCosts","MoneySpent")], na.rm=T)
Data$MoneySpent  <- ifelse(Data$MoneySpent==0,NA,Data$MoneySpent)
TEMP = Data[Data$ProjectIDs=="P-0634",]
View(TEMP)
Data = DataUp
Data$MoneySpent[Data$Filt == T] <- rowSums(Data[Data$Filt == T, c("FixedCosts","HourlyCosts")], na.rm=T)
Data <- AvgTimeBookings(Data)
# Adding up FixedCosts
Data$MoneySpent <- rowSums(Data[,c("FixedCosts","MoneySpent")], na.rm=T)
Data$MoneySpent  <- ifelse(Data$MoneySpent==0,NA,Data$MoneySpent)
TEMP = Data[Data$ProjectIDs=="P-0634",]
View(TEMP)
runApp()
runApp('inst/shinyApp')
Data$MoneySpent[Data$Filt == T] <- rowSums(Data[Data$Filt == T, c("FixedCosts","HourlyCosts")], na.rm=T)
Data <- AvgTimeBookings(Data)
# Adding up FixedCosts
Data$MoneySpent <- rowSums(Data[,c("FixedCosts","MoneySpent")], na.rm=T)
Data$MoneySpent  <- ifelse(Data$MoneySpent==0,NA,Data$MoneySpent)
TEMP = Data[Data$ProjectIDs=="P-0634",]
View(TEMP)
devtools::build(); devtools::install()
shiny::runApp('inst/shinyApp')
DataUp <- DataUp[is.na(DataUp$BookedDate) | DataUp$BookedDate %in% as.Date("2020-01-01"):as.Date("2022-12-29"),]
min(DataUp$BookedDate, na.rm = T)
TEMP = Calculations(DataUp)
View(TEMP)
sum(TEMP$MoneySpent[TEMP$ProjectID=="002.003"])
sum(TEMP$MoneySpent[TEMP$ProjectID=="002.003"], na.rm = T)
sum(TEMP$MoneySpent[TEMP$ProjectID=="005.002"], na.rm = T)
sum(TEMP$MoneySpent[grepl("002.00", TEMP$ProjectID)], na.rm = T)
sum(TEMP$MoneySpent[which(grepl("002.00", TEMP$ProjectID))], na.rm = T)
unique(TEMP$ProjectID[grepl("002.00", TEMP$ProjectID)])
# Computing different calculations based on filtering parameters
# THERE SEEMS TO BE A PROBLEM HERE:
# The MoneySpent over project doesn't make sense when TimeBooking filters are applied
# DataUp <- DataUp[is.na(DataUp$BookedDate) | DataUp$BookedDate %in% as.Date("2020-01-01"):as.Date("2022-12-29"),]
# Project P-0634 (259477240) as example: 908.10000 (DM) + 35910.000000 (Cloud) NOT EQUAL TO 95078.100000 (Total)
DataUp <- Calculations(DataUp)
TEMP = DataUp[DataUp$ProjectName==259477240,]
TEMP = DataUp[DataUp$ProjectName=="259477240",]
TEMP = DataUp[DataUp$ProjectLvl=="259477240",]
sum(TEMP$MoneySpent[which(grepl("002.00", TEMP$ProjectID))], na.rm = T)
View(TEMP)
sum(TEMP$MoneySpent[which(grepl("005.00", TEMP$ProjectID))], na.rm = T)
35910 + 908.1
36818.1 + 58260
devtools::build();devtools::install(); CTUNetwork::runCTUNetworkApp()
CTUNetwork::runCTUNetworkApp()
devtools::build();devtools::install()
CTUNetwork::runCTUNetworkApp()
library("pf")
library("CTUNetwork")
# Retrieve data from ProjectFacts
All_Tabs <- getPFData()
# Only keeping useful information from All_Tabs
# $activitycategory = activity types - e.g. billable, non-billable
# $customfields = list of the custom fields
# $financearticle = types of work packages (Basic, Light, Full services)
# $projectstatedefinition = Explanations related to projects state code
# $financeposition = Invoices at package level
# $financerecord = Invoices total at project level
All_Tabs = All_Tabs[c("activitydata","customer","crmkontakt","financeposition",
"project","projectstatedefinition","worker")]
# Retrieve data
Data <- extractData(All_Tabs)
# Filter data
Data <- filterData(Data, All_Tabs)
# Filtering the lines corresponding to the project level (the aim is to separate for each division)
Data$Filt <- grepl("\\.|C-", Data$ProjectID)
# Free-up memory space
remove(All_Tabs)
# Changing data type
Data[,c("ProjectIDs","ProjectNames","State")] <- lapply(Data[,c("ProjectIDs","ProjectNames","State")], as.character)
# Dataframe with type of projects and corresponding patterns
ProjTypes.df <- data.frame(Name = c("External", "Consulting","Internal","Internal","FTE"),
Pattern = c("P-","C-","I-","IB-","FTE-"))
ProjStr <- c("P-","C-","I-","IB-","FTE-")
# values to show, or not show, these will be the 'choices' and 'selected' values
# for the checkboxGroupInput()
AllRows <- 1:dim(Data)[2]-1
1:dim(Data)[2]-1
# values to show, or not show, these will be the 'choices' and 'selected' values
# for the checkboxGroupInput()
AllRows <- 1:(dim(Data)[2]-1)
names(AllRows) <- colnames(Data)[-dim(Data)[2]]
SelectRows <- AllRows[c(1,3,4,8,18,20,21,22,23,24)]
AllRows
library(shiny)
library(data.table)
library(DT)
library(purrr)
# ---
# Data Preparation
# ---
dat <- rbind(
data.table(Continent = rep("Europe", 3),
Country = c("England", "France", "Italy"),
x = 1 : 3,
y = 7 : 5),
data.table(Continent = rep("Africa", 3),
Country = c("Niger", "Benin", "Uganda"),
x = 5 : 7,
y = 2 : 4))
# Outer data table - country values aggregated by continent
parents  <- dat[, .(TotalX = sum(x), MeanY = mean(y)), by = Continent]
# List of inner data tables - list should have length of parents rows
children <- split(dat, by = "Continent") %>%
purrr::map(function(x) {x[, .(Country, x, y)]})
# ---
# Helping functions
# from https://stackoverflow.com/questions/60662749/parent-child-rows-in-r
# ---
NestedData <- function(dat, children){
stopifnot(length(children) == nrow(dat))
g <- function(d){
if(is.data.frame(d)){
purrr::transpose(d)
}else{
purrr::transpose(NestedData(d[[1]], children = d$children))
}
}
subdats <- lapply(children, g)
oplus <- sapply(subdats, function(x) if(length(x)) "&oplus;" else "")
cbind(" " = oplus, dat, "_details" = I(subdats), stringsAsFactors = FALSE)
}
rowNames <- FALSE
colIdx <- as.integer(rowNames)
Dat <- NestedData(
dat = parents,
children = children
)
parentRows <- which(Dat[, 1] != "")
# make the callback - is dependent on input data (should vanish in future)
callback = JS(
sprintf("var parentRows = [%s];", toString(parentRows-1)),
sprintf("var j0 = %d;", colIdx),
"var nrows = table.rows().count();",
"for(var i=0; i < nrows; ++i){",
"  if(parentRows.indexOf(i) > -1){",
"    table.cell(i,j0).nodes().to$().css({cursor: 'pointer'});",
"  }else{",
"    table.cell(i,j0).nodes().to$().removeClass('details-control');",
"  }",
"}",
"",
"// make the table header of the nested table",
"var format = function(d, childId){",
"  if(d != null){",
"    var html = ",
"      '<table class=\"display compact hover\" ' + ",
"      'style=\"padding-left: 30px;\" id=\"' + childId + '\"><thead><tr>';",
"    for(var key in d[d.length-1][0]){",
"      html += '<th>' + key + '</th>';",
"    }",
"    html += '</tr></thead></table>'",
"    return html;",
"  } else {",
"    return '';",
"  }",
"};",
"",
"// row callback to style the rows of the child tables",
"var rowCallback = function(row, dat, displayNum, index){",
"  if($(row).hasClass('odd')){",
"  } else {",
"  }",
"};",
"",
"// header callback to style the header of the child tables",
"var headerCallback = function(thead, data, start, end, display){",
"  $('th', thead).css({",
"    'border-top': '3px solid indigo',",
"    'color': 'indigo',",
"  });",
"};",
"",
"// make the datatable",
"var format_datatable = function(d, childId){",
"  var dataset = [];",
"  var n = d.length - 1;",
"  for(var i = 0; i < d[n].length; i++){",
"    var datarow = $.map(d[n][i], function (value, index) {",
"      return [value];",
"    });",
"    dataset.push(datarow);",
"  }",
"  var id = 'table#' + childId;",
"  if (Object.keys(d[n][0]).indexOf('_details') === -1) {",
"    var subtable = $(id).DataTable({",
"                 'data': dataset,",
"                 'autoWidth': true,",
"                 'deferRender': true,",
"                 'info': false,",
"                 'lengthChange': false,",
"                 'ordering': d[n].length > 1,",
"                 'order': [],",
"                 'paging': false,",
"                 'scrollX': false,",
"                 'scrollY': false,",
"                 'searching': false,",
"                 'sortClasses': false,",
"                 'rowCallback': rowCallback,",
"                 'headerCallback': headerCallback,",
"                 'columnDefs': [{targets: '_all', className: 'dt-center'}]",
"               });",
"  } else {",
"    var subtable = $(id).DataTable({",
"            'data': dataset,",
"            'autoWidth': true,",
"            'deferRender': true,",
"            'info': false,",
"            'lengthChange': false,",
"            'ordering': d[n].length > 1,",
"            'order': [],",
"            'paging': false,",
"            'scrollX': false,",
"            'scrollY': false,",
"            'searching': false,",
"            'sortClasses': false,",
"            'rowCallback': rowCallback,",
"            'headerCallback': headerCallback,",
"            'columnDefs': [",
"              {targets: -1, visible: false},",
"              {targets: 0, orderable: false, className: 'details-control'},",
"              {targets: '_all', className: 'dt-center'}",
"             ]",
"          }).column(0).nodes().to$().css({cursor: 'pointer'});",
"  }",
"};",
"",
"// display the child table on click",
"table.on('click', 'td.details-control', function(){",
"  var tbl = $(this).closest('table'),",
"      tblId = tbl.attr('id'),",
"      td = $(this),",
"      row = $(tbl).DataTable().row(td.closest('tr')),",
"      rowIdx = row.index();",
"  if(row.child.isShown()){",
"    row.child.hide();",
"    td.html('&oplus;');",
"  } else {",
"    var childId = tblId + '-child-' + rowIdx;",
"    row.child(format(row.data(), childId)).show();",
"    td.html('&CircleMinus;');",
"    format_datatable(row.data(), childId);",
"  }",
"});")
# ---
# App definition
# ---
ui <- fluidPage(# Application title
titlePanel("Collapse/Expand table"),
mainPanel(DTOutput("my_table")))
server <- function(input, output) {
output$my_table <- DT::renderDT({
datatable(
Dat, callback = callback, rownames = rowNames,
escape = - colIdx - 1,
options = list(
dom = "t",
columnDefs = list(
list(visible = FALSE, targets = ncol(Dat)-1+colIdx),
list(orderable = FALSE, className = 'details-control',
targets = colIdx),
list(className = "dt-center", targets = "_all")
)
)
)
})
}
# Run the application
shinyApp(ui = ui, server = server)
dat <- rbind(
data.frame(Continent = rep("Europe", 3),
Country = c("England", "France", "Italy"),
x = 1 : 3,
y = 7 : 5),
data.frame(Continent = rep("Africa", 3),
Country = c("Niger", "Benin", "Uganda"),
x = 5 : 7,
y = 2 : 4))
library(shiny)
library(DT)
ui <- fluidPage(# Application title
titlePanel("Collapse/Expand table"),
mainPanel(DTOutput("my_table")))
callback_js <- JS(
"table.on('click', 'tr.group', function () {",
"  var rowsCollapse = $(this).nextUntil('.group');",
"  $(rowsCollapse).toggleClass('hidden');",
"});"
)
dat <- rbind(
data.frame(Continent = rep("Europe", 3),
Country = c("England", "France", "Italy"),
x = 1 : 3,
y = 7 : 5),
data.frame(Continent = rep("Africa", 3),
Country = c("Niger", "Benin", "Uganda"),
x = 5 : 7,
y = 2 : 4))
server <- function(input, output) {
output$my_table <- DT::renderDT({
datatable(
dat,
extensions = 'RowGroup',
options = list(rowGroup = list(dataSrc = 1), pageLength = 20),
callback = callback_js,
selection = 'none'
)
})
}
# Run the application
shinyApp(ui = ui, server = server)
devtools::build();devtools::install()
library("CTUNetwork")
runApp('inst/shinyApp')
DataUpTab
# Removing the list of all workers at the project level (useless)
DataUpTab <- AllData()$DataUp
Idx = grepl("\\,", DataUpTab$Workers)
DataUpTab$Workers[Idx] <- NA
# No need to repeat the DLF support & service values
DataUpTab$DLFSupport[DataUpTab$Levels == F] <- NA
DataUpTab$DLFReached <- as.factor(DataUpTab$DLFReached) # looks different if not factor
DataUpTab$Service[DataUpTab$Levels == F] <- NA
# Round MoneySpent to 2 decimals
DataUpTab$MoneySpent <- round(DataUpTab$MoneySpent,2)
# Columns are adjusted based on checkboxes
Cols <- c(colnames(DataUpTab[as.integer(input$tablevars)]),"Fraction","Levels")
input$tabledata
# Rows are adjusted based on input
Rows <- ifelse(input$tabledata,"Yes", 1:dim(DataUpTab)[1], which(!DataUpTab$Filt))
head(DataUpTab$Filt)
input$tabledata == "Yes"
# Rows are adjusted based on input
Rows <- ifelse(input$tabledata == "Yes", 1:dim(DataUpTab)[1], which(!DataUpTab$Filt))
Rows
1:dim(DataUpTab)[1]
which(!DataUpTab$Filt)
View(DataUpTab)
# Rows are adjusted based on input
Rows <- ifelse(input$tabledata == "Yes", 1:dim(DataUpTab)[1], which(DataUpTab$Filt))
Rows
# Rows are adjusted based on input
Rows <- ifelse(input$tabledata == "Yes", seq(1,dim(DataUpTab)[1]), which(DataUpTab$Filt))
Rows
dim(DataUpTab)[1]
# Rows are adjusted based on input
Rows <- ifelse(input$tabledata == "No", seq(1, dim(DataUpTab)[1]), which(DataUpTab$Filt))
Rows
# Rows are adjusted based on input
ifelse(input$tabledata == "Yes", Rows <- 1:dim(DataUpTab)[1], Rows <- which(DataUpTab$Filt))
BuildTable(DataUpTab[Rows,Cols])
IdxProj <- which(DataUpTab$ProjectIDs==input$node_id)
devtools::build();devtools::install(); library(CTUNetwork)
library(CTUNetwork)
runApp('inst/shinyApp')
?union
union(c(1,2,3,4), c(2,3,6))
intersect(c(1,2,3,4), c(2,3,6))
devtools::build();devtools::install(); library(CTUNetwork)
runApp('inst/shinyApp')
devtools::build();devtools::install(); library(CTUNetwork)
library(CTUNetwork)
runApp('inst/shinyApp')
runApp('inst/shinyApp')
?selectInput
?visOptions
?dropdownButton
library(shinyWidgets)
?dropdownButton
devtools::build();devtools::install(); library(CTUNetwork)
runApp('inst/shinyApp')
runApp('Tests/Test3.R')
visOptions?
dsf$
%>%io
?visOptions
runApp('Tests/Test3.R')
